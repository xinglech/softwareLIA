# hardware_results_collector.py
import pandas as pd
import json
from datetime import datetime
import sys

def collect_hardware_results(stream_output_file, output_format='both'):
    """
    Collect and standardize hardware LIA results from stream.py output
    
    Args:
        stream_output_file: CSV file generated by stream.py
        output_format: 'json', 'csv', or 'both'
    """
    
    # Read hardware data
    df = pd.read_csv(stream_output_file)
    
    # Calculate summary statistics
    results = {
        'source': 'hardware_lia_stream',
        'timestamp': datetime.now().isoformat(),
        'original_file': stream_output_file,
        'data_points': len(df),
        'summary_statistics': {}
    }
    
    # Process different variable configurations
    if 'X' in df.columns and 'Y' in df.columns:
        X = df['X'].values
        Y = df['Y'].values
        
        results['summary_statistics'] = {
            'X_mean': float(np.mean(X)),
            'Y_mean': float(np.mean(Y)),
            'X_std': float(np.std(X)),
            'Y_std': float(np.std(Y)),
            'R_mean': float(np.sqrt(np.mean(X)**2 + np.mean(Y)**2)),
            'phase_mean': float(np.degrees(np.arctan2(np.mean(Y), np.mean(X)))),
            'sampling_rate': len(df) / 10.0  # Assuming 10-second acquisition
        }
    
    # Save in standardized format
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    
    if output_format in ['json', 'both']:
        json_file = f'hardware_results_{timestamp}.json'
        with open(json_file, 'w') as f:
            json.dump(results, f, indent=2)
        print(f"Hardware results saved to: {json_file}")
    
    if output_format in ['csv', 'both']:
        csv_file = f'hardware_results_{timestamp}.csv'
        df.to_csv(csv_file, index=False)
        print(f"Hardware data saved to: {csv_file}")
    
    return results

if __name__ == "__main__":
    if len(sys.argv) > 1:
        collect_hardware_results(sys.argv[1])
    else:
        print("Usage: python hardware_results_collector.py <stream_output.csv>")
